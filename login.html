<!DOCTYPE html>
<html lang="es" class="h-full">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Iniciar Sesión - Mercadeo PCB</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Google Identity -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <link href="styles.css" rel="stylesheet">
</head>

<body class="h-full font-body overflow-hidden">
  <div class="min-h-full flex items-center justify-center bg-gradient-to-br from-blue-900 via-purple-900 to-pink-900 p-4">
    <!-- Botón Regresar (esquina superior izquierda) -->
    <a href="index.html"
      class="fixed top-4 left-4 flex items-center gap-2 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all hover:scale-105 font-semibold text-sm border border-white/20 text-white backdrop-blur-sm z-10">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      <span>Regresar</span>
    </a>

    <!-- Card de Login -->
    <div class="w-full max-w-md">
      <div class="glass-card rounded-2xl p-8 border border-white/10 animate-slide-up">
        <!-- Logo y Título -->
        <div class="text-center mb-8">
          <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-white/20 p-4 backdrop-blur-lg border-2 border-white/30">
            <img src="galeria/image1.png" alt="Logo" class="w-full h-full object-contain">
          </div>
          <h1 class="font-display font-bold text-3xl text-white mb-2">Mercadeo PCB</h1>
          <p class="text-white/70 text-sm">Inicia sesión para continuar</p>
        </div>

        <!-- Botón de Google Sign-In -->
        <div class="mb-6 flex justify-center">
          <div id="g_id_onload"
               data-client_id="643448239763-b4oh8928v0mso80lmctkls5rceqn2a3b.apps.googleusercontent.com"
               data-callback="loginGoogle"
               data-auto_prompt="false">
          </div>

          <div class="g_id_signin"
               data-type="standard"
               data-size="large"
               data-theme="filled_blue"
               data-text="signin_with"
               data-shape="rectangular"
               data-logo_alignment="left"
               data-width="350">
          </div>
        </div>

        <!-- Separador -->
        <div class="relative my-6">
          <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-white/20"></div>
          </div>
          <div class="relative flex justify-center text-sm">
            <span class="px-4 bg-transparent text-white/60">O continúa con</span>
          </div>
        </div>

        <!-- Formulario de Login Manual -->
        <form id="manual-login-form" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-white/80 mb-2">Usuario</label>
            <input type="text" id="username-input"
              class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
              placeholder="Ingresa tu usuario" required>
          </div>

          <div>
            <label class="block text-sm font-medium text-white/80 mb-2">Contraseña</label>
            <input type="password" id="password-input"
              class="w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/40 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
              placeholder="Ingresa tu contraseña" required>
          </div>

          <button type="submit"
            class="w-full py-3 px-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white font-semibold rounded-lg transition-all hover:scale-105 shadow-lg">
            Iniciar Sesión
          </button>
        </form>

        <!-- Mensaje de Error -->
        <div id="error-message" class="hidden mt-4 p-3 bg-red-500/20 border border-red-500/50 rounded-lg text-red-200 text-sm text-center">
        </div>

        <!-- Mensaje de Éxito -->
        <div id="success-message" class="hidden mt-4 p-3 bg-green-500/20 border border-green-500/50 rounded-lg text-green-200 text-sm text-center">
        </div>

        <!-- Footer -->
        <div class="mt-6 text-center">
          <p class="text-white/50 text-xs">
            Escuela Superior Vocacional<br>
            Pablo Colón Berdecia
          </p>
        </div>
      </div>

      <!-- Información adicional -->
      <div class="mt-6 text-center">
        <p class="text-white/60 text-sm">
          ¿No tienes cuenta?
          <a href="index.html" class="text-purple-400 hover:text-purple-300 font-semibold">
            Continuar como invitado
          </a>
        </p>
      </div>
    </div>
  </div>

  <script src="auth.js"></script>
  <script>
    // ========== GOOGLE SIGN-IN ==========
    function loginGoogle(respuesta) {
      const token = respuesta.credential;

      // Decodificar el token JWT de Google
      const datos = JSON.parse(atob(token.split('.')[1]));

      // Guardar información del usuario
      const userData = {
        name: datos.name,
        email: datos.email,
        picture: datos.picture,
        provider: 'google',
        token: token
      };

      // Guardar en localStorage
      localStorage.setItem('user_data', JSON.stringify(userData));
      localStorage.setItem('user_logged_in', 'true');

      // Mostrar mensaje de éxito
      showSuccess(`¡Bienvenido, ${datos.name}!`);

      // Redirigir a la página principal después de 1 segundo
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 1000);
    }

    // ========== LOGIN MANUAL ==========
    document.getElementById('manual-login-form').addEventListener('submit', function(e) {
      e.preventDefault();

      const username = document.getElementById('username-input').value;
      const password = document.getElementById('password-input').value;

      // Verificar credenciales (usando el sistema existente de auth.js)
      if (username === 'Admin' && password === 'Mercadeo2026') {
        // Crear token
        const token = createToken(username);
        localStorage.setItem('mercadeo_auth_token', token);
        localStorage.setItem('user_logged_in', 'true');

        // Guardar datos del usuario
        const userData = {
          name: 'Administrador',
          email: 'admin@mercadeo.pcb',
          provider: 'manual',
          role: 'admin'
        };
        localStorage.setItem('user_data', JSON.stringify(userData));

        showSuccess('¡Inicio de sesión exitoso!');

        setTimeout(() => {
          window.location.href = 'index.html';
        }, 1000);
      } else {
        showError('Usuario o contraseña incorrectos');
      }
    });

    // ========== FUNCIONES DE UI ==========
    function showError(message) {
      const errorDiv = document.getElementById('error-message');
      errorDiv.textContent = message;
      errorDiv.classList.remove('hidden');

      setTimeout(() => {
        errorDiv.classList.add('hidden');
      }, 3000);
    }

    function showSuccess(message) {
      const successDiv = document.getElementById('success-message');
      successDiv.textContent = message;
      successDiv.classList.remove('hidden');
    }
  </script>
</body>

</html>